{{
  config(
    materialized='table', 
  	)
}}

--formats algo codes into a table of arrays by type

select * 
    from (select distinct code as code_value,category from {{ ref('claims_codes') }} )
     pivot(array_agg(code_value) for category in ('HF','HF_SYSTOLIC',
'HF_DIASTOLIC',
'HF_LEFT',
'HF_UNSPECIFIED',
'DX_DEFIBRILLATOR',
'DX_AFIB',
'DX_ANEMIA',
'DX_CABG',
'CPT_CABG',
'DX_CARDIOMYOPATHY',
'DX_COPD',
'DX_DEPRESSION',
'DX_HTN_NEPHROPATHY',
'DX_HYPERLIPIDEMIA',
'DX_HYPERTENSION',
'DX_HYPOTENSION',
'DX_MI',
'DX_OBESITY',
'CPT_OBESITY',
'RX_OBESITY',
'DX_OTH_DYSRHYTHMIA',
'DX_PSYCHOSIS',
'DX_RHEUMATIC_HEART',
'DX_SLEEP_APNEA',
'DX_STABLE_ANGINA',
'DX_VALVE_DISORDER',
'CPT_VALVE_DISORDER',
'RX_THIAZIDE',
'RX_NITRATES',
'RX_BBLOCKER',
'RX_DIGOXIN',
'RX_ACE',
'RX_LOOP_DIURETIC'))
     as p (HF,
HF_SYSTOLIC,
HF_DIASTOLIC,
HF_LEFT,
HF_UNSPECIFIED,
DX_DEFIBRILLATOR,
DX_AFIB,
DX_ANEMIA,
DX_CABG,
CPT_CABG,
DX_CARDIOMYOPATHY,
DX_COPD,
DX_DEPRESSION,
DX_HTN_NEPHROPATHY,
DX_HYPERLIPIDEMIA,
DX_HYPERTENSION,
DX_HYPOTENSION,
DX_MI,
DX_OBESITY,
CPT_OBESITY,
RX_OBESITY,
DX_OTH_DYSRHYTHMIA,
DX_PSYCHOSIS,
DX_RHEUMATIC_HEART,
DX_SLEEP_APNEA,
DX_STABLE_ANGINA,
DX_VALVE_DISORDER,
CPT_VALVE_DISORDER,
RX_THIAZIDE,
RX_NITRATES,
RX_BBLOCKER,
RX_DIGOXIN,
RX_ACE,
RX_LOOP_DIURETIC)